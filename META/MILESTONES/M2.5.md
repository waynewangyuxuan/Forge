# M2.5: GitHub 集成

> **目标**：实现 GitHub-first 项目创建流程

**状态**: pending
**依赖**: M2

---

## 背景

Forge 采用 GitHub-first 设计：每个项目必须绑定 GitHub 仓库。创建项目时自动创建 GitHub 仓库并 clone 到本地，用户无需手动选择文件位置。

**好处**：
- 简化用户体验：创建项目 = 创建 GitHub 仓库
- 用户无需关心文件位置
- 所有项目统一管理在 GitHub Project "forge" 下

---

## 交付物

### 后端

- [ ] GitHubAdapter 实现
  - [ ] `src/main/infrastructure/adapters/github.adapter.ts`
  - [ ] OAuth 认证流程（通过 `gh` CLI）
  - [ ] 创建仓库 (`createRepository`)
  - [ ] Clone 仓库 (`cloneRepository`)
  - [ ] 删除仓库 (`deleteRepository`)
  - [ ] GitHub Project 操作 (`ensureProject`, `addRepoToProject`)
- [ ] 更新 CreateProjectUseCase
  - [ ] 调用 GitHub 创建仓库
  - [ ] Clone 到 clone root 目录
  - [ ] 添加到 GitHub Project "forge"
- [ ] github.ipc.ts
  - [ ] `github:checkAuth`
  - [ ] `github:authenticate`
  - [ ] `github:getUser`
  - [ ] `github:getCloneRoot`
  - [ ] `github:setCloneRoot`
- [ ] 设置存储
  - [ ] 持久化 clone root 目录配置

### 前端

- [ ] 更新 CreateProjectModal
  - [ ] 移除 Path 输入框
  - [ ] 显示 GitHub 仓库创建信息
  - [ ] 显示将添加到 GitHub Project "forge"
- [ ] 更新 SettingsPage
  - [ ] GitHub 认证状态显示
  - [ ] GitHub 登录/登出按钮
  - [ ] Clone 位置配置（Browse 选择）
- [ ] GitHub 认证状态 hook
  - [ ] `useGitHubAuth` hook

---

## 验收标准

- [ ] 首次启动时检测 GitHub 认证状态
- [ ] 未认证时提示登录 GitHub
- [ ] 能配置 clone 根目录（默认 ~/Projects）
- [ ] 创建项目时：
  - [ ] 自动创建 GitHub 仓库
  - [ ] 自动 clone 到 clone root
  - [ ] 自动添加到 GitHub Project "forge"
  - [ ] 创建 META/ 目录结构
- [ ] 项目路径由 clone root + repo name 自动派生
- [ ] 删除项目时可选择是否删除 GitHub 仓库

---

## IPC 通道

| 通道 | 输入 | 输出 | 说明 |
|------|------|------|------|
| `github:checkAuth` | `void` | `GitHubAuthStatus` | 检查 GitHub 认证状态 |
| `github:authenticate` | `void` | `GitHubUser` | 触发 GitHub OAuth 认证 |
| `github:getUser` | `void` | `GitHubUser \| null` | 获取当前认证用户 |
| `github:getCloneRoot` | `void` | `string` | 获取 clone 根目录 |
| `github:setCloneRoot` | `{ path }` | `void` | 设置 clone 根目录 |

---

## 类型定义

```typescript
interface GitHubAuthStatus {
  authenticated: boolean
  user?: GitHubUser
}

interface GitHubUser {
  login: string
  name: string
  avatarUrl: string
}

interface GitHubRepo {
  id: string
  name: string
  fullName: string          // e.g., "waynewang/kindle-anki"
  htmlUrl: string
  cloneUrl: string
  sshUrl: string
}

interface GitHubProject {
  id: string
  name: string
  number: number
}
```

---

## 实现策略

### GitHub CLI 依赖

使用 `gh` CLI 进行 GitHub 操作：
- 认证：`gh auth status` / `gh auth login`
- 创建仓库：`gh repo create`
- 删除仓库：`gh repo delete`
- API 调用：`gh api`

**好处**：
- 不需要处理 OAuth token 存储
- 利用用户已有的 GitHub 认证
- 简化实现复杂度

### Clone 根目录

- 默认值：`~/Projects`
- 存储位置：app data 目录下的 settings 文件
- 用户可在 Settings 中修改

---

## 参考文档

- [IPC.md](../IPC/IPC.md) - 2.11 GitHub
- [INTERFACES.md](../BACKEND/INTERFACES.md) - 4.6 IGitHubAdapter
- [DATA-MODEL.md](../BACKEND/DATA-MODEL.md) - 3.1 projects 表
- [PRODUCT.md](../CORE/PRODUCT.md) - 2.2 GitHub 集成
