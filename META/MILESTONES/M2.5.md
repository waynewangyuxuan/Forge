# M2.5: GitHub 集成

> **目标**：实现 GitHub-first 项目创建流程

**状态**: ✅ complete
**依赖**: M2
**完成日期**: 2026-01-09

---

## 背景

Forge 采用 GitHub-first 设计：每个项目必须绑定 GitHub 仓库。创建项目时自动创建 GitHub 仓库并 clone 到本地，用户无需手动选择文件位置。

**好处**：
- 简化用户体验：创建项目 = 创建 GitHub 仓库
- 用户无需关心文件位置
- 使用 `gh` CLI 无需存储 OAuth token

---

## 交付物

### 后端

- [x] GitHubAdapter 实现
  - [x] `src/main/infrastructure/adapters/github.adapter.ts`
  - [x] 认证检查（通过 `gh` CLI）
  - [x] 创建仓库 (`createRepo`)
  - [x] Clone 仓库 (`cloneRepo`)
  - [x] 获取用户信息 (`getAuthenticatedUser`)
- [x] 更新 CreateProjectUseCase
  - [x] 调用 GitHub 创建仓库
  - [x] Clone 到 clone root 目录
  - [x] 创建 META/CORE 目录结构
- [x] github.ipc.ts
  - [x] `github:checkAuth`
  - [x] `github:createRepo`
  - [x] `github:cloneRepo`
- [x] 设置存储
  - [x] SQLiteSettingsRepository
  - [x] 持久化 clone root 目录配置

### 前端

- [x] 更新 CreateProjectModal
  - [x] 移除 Path 输入框
  - [x] 添加 Description 和 Private 选项
  - [x] GitHub 错误处理
- [x] 更新 SettingsPage
  - [x] GitHub 认证状态显示
  - [x] 用户头像和用户名
  - [x] Clone 位置配置（Browse 选择）
- [x] GitHub 认证状态 hook
  - [x] `useGitHubAuth` hook

---

## 验收标准

- [x] 首次启动时检测 GitHub 认证状态
- [x] 未认证时提示登录 GitHub（gh auth login）
- [x] 能配置 clone 根目录（默认 ~/Projects）
- [x] 创建项目时：
  - [x] 自动创建 GitHub 仓库
  - [x] 自动 clone 到 clone root
  - [x] 创建 META/CORE 目录结构
- [x] 项目路径由 clone root + repo name 自动派生

---

## IPC 通道

| 通道 | 输入 | 输出 | 说明 |
|------|------|------|------|
| `github:checkAuth` | `void` | `GitHubAuthStatus` | 检查 GitHub 认证状态 |
| `github:authenticate` | `void` | `GitHubUser` | 触发 GitHub OAuth 认证 |
| `github:getUser` | `void` | `GitHubUser \| null` | 获取当前认证用户 |
| `github:getCloneRoot` | `void` | `string` | 获取 clone 根目录 |
| `github:setCloneRoot` | `{ path }` | `void` | 设置 clone 根目录 |

---

## 类型定义

```typescript
interface GitHubAuthStatus {
  authenticated: boolean
  user?: GitHubUser
}

interface GitHubUser {
  login: string
  name: string
  avatarUrl: string
}

interface GitHubRepo {
  id: string
  name: string
  fullName: string          // e.g., "waynewang/kindle-anki"
  htmlUrl: string
  cloneUrl: string
  sshUrl: string
}

interface GitHubProject {
  id: string
  name: string
  number: number
}
```

---

## 实现策略

### GitHub CLI 依赖

使用 `gh` CLI 进行 GitHub 操作：
- 认证：`gh auth status` / `gh auth login`
- 创建仓库：`gh repo create`
- 删除仓库：`gh repo delete`
- API 调用：`gh api`

**好处**：
- 不需要处理 OAuth token 存储
- 利用用户已有的 GitHub 认证
- 简化实现复杂度

### Clone 根目录

- 默认值：`~/Projects`
- 存储位置：app data 目录下的 settings 文件
- 用户可在 Settings 中修改

---

## 参考文档

- [IPC.md](../IPC/IPC.md) - 2.11 GitHub
- [INTERFACES.md](../BACKEND/INTERFACES.md) - 4.6 IGitHubAdapter
- [DATA-MODEL.md](../BACKEND/DATA-MODEL.md) - 3.1 projects 表
- [PRODUCT.md](../CORE/PRODUCT.md) - 2.2 GitHub 集成
