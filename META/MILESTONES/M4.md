# M4: Scaffold 生成

> **目标**：实现 Spec → TODO.md 的 AI 生成

**状态**: pending
**依赖**: M3

---

## 交付物

### 后端

- [ ] ClaudeCliAdapter（调用 Claude Code CLI）
- [ ] Domain Engines
  - [ ] PromptRenderer（渲染 prompt 模板）
  - [ ] StateMachine（开发流状态机）
- [ ] Config 文件
  - [ ] config/prompts/scaffold-generator.yaml
  - [ ] config/state-machines/dev-flow.yaml
- [ ] Scaffold Use Cases
  - [ ] generate-scaffold.ts
- [ ] scaffold:* IPC 事件发送

### 前端

- [ ] RealtimeStore scaffold 订阅
- [ ] SpecPage "Generate" 按钮
- [ ] 生成进度展示（流式消息）
- [ ] 生成完成后自动跳转 ReviewPage

---

## 验收标准

- [ ] 点击 Generate 后能看到实时进度消息
- [ ] 生成完成后 TODO.md 出现在 META/
- [ ] 生成完成后 CLAUDE.md 出现在 META/
- [ ] Version 状态从 `drafting` → `scaffolding` → `reviewing`
- [ ] 生成失败时显示错误信息
- [ ] Claude CLI 不可用时有明确提示

---

## IPC 通道

| 类型 | 通道 | 说明 |
|------|------|------|
| Invoke | `spec:generateScaffold` | 触发生成 |
| Event | `scaffold:progress` | 进度消息 |
| Event | `scaffold:completed` | 生成完成 |
| Event | `scaffold:error` | 生成出错 |

---

## 状态流转

```
drafting ──[GENERATE_SCAFFOLD]──► scaffolding ──[SUCCESS]──► reviewing
                                       │
                                       └──[ERROR]──► error
```

---

## Prompt 设计要点

scaffold-generator.yaml 需要：
- 读取 PRODUCT.md + TECHNICAL.md
- 输出结构化的 TODO.md（任务列表）
- 输出 CLAUDE.md（AI 执行指令）
- 考虑任务依赖关系

---

## 参考文档

- [CONFIG-DRIVEN.md](../BACKEND/CONFIG-DRIVEN.md) - Prompt 模板格式
- [DOMAIN.md](../BACKEND/DOMAIN.md) - StateMachine 引擎
- [INTERFACES.md](../BACKEND/INTERFACES.md) - IClaudeAdapter
