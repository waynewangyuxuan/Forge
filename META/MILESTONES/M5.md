# M5: Review 流程

> **目标**：实现 TODO.md 的 Review 和 Approve

**状态**: pending
**依赖**: M4

---

## 交付物

### 后端

- [ ] Domain Engines
  - [ ] TodoParser（解析 TODO.md → ExecutionPlan）
- [ ] Review Use Cases
  - [ ] get-todo.ts
  - [ ] read-todo-raw.ts
  - [ ] save-todo-raw.ts
  - [ ] add-feedback.ts
  - [ ] clear-feedback.ts
  - [ ] approve-review.ts
- [ ] Scaffold Use Cases
  - [ ] regenerate-scaffold.ts
- [ ] review.ipc.ts

### 前端

- [ ] ReviewPage 页面
  - [ ] 解析后的任务列表视图
  - [ ] 原始 Markdown 编辑视图（可切换）
- [ ] TaskList 组件
- [ ] TaskItem 组件
- [ ] FeedbackPanel 组件（整体 comment）
- [ ] Approve 按钮
- [ ] Regenerate 按钮

---

## 验收标准

- [ ] ReviewPage 正确展示解析后的任务列表
- [ ] 每个任务显示：编号、描述、依赖
- [ ] 能切换到原始 TODO.md 编辑模式
- [ ] 能添加整体 comment 作为 feedback
- [ ] Regenerate 能基于 feedback 重新生成
- [ ] Approve 后 Version 状态变为 `ready`

---

## IPC 通道

| 通道 | 说明 |
|------|------|
| `review:getTodo` | 获取解析后的 ExecutionPlan |
| `review:readTodoRaw` | 获取 TODO.md 原始文本 |
| `review:saveTodoRaw` | 保存 TODO.md 原始文本 |
| `review:addFeedback` | 添加整体 comment（MVP） |
| `review:clearFeedback` | 清除 feedback |
| `review:regenerate` | 基于 feedback 重新生成 |
| `review:approve` | 确认通过 |

---

## TODO.md 解析格式

```markdown
## Phase 1: 基础设施

- [ ] 001: 创建项目结构 @priority(high)
- [ ] 002: 配置 TypeScript @depends(001)
- [ ] 003: 设置 ESLint @depends(001)

## Phase 2: 核心功能

- [ ] 004: 实现用户模块 @depends(002,003)
```

解析为：

```typescript
interface ExecutionPlan {
  phases: Phase[]
  tasks: Task[]
}

interface Task {
  id: string           // "001"
  description: string  // "创建项目结构"
  phase: string        // "Phase 1: 基础设施"
  priority?: string    // "high"
  depends: string[]    // ["001", "002"]
  status: TaskStatus
}
```

---

## 参考文档

- [DOMAIN.md](../BACKEND/DOMAIN.md) - TodoParser
- [IPC.md](../IPC/IPC.md) - 2.4 Review
- [PAGES.md](../FRONTEND/PAGES.md) - ReviewPage
