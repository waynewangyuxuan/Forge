# M8: Dashboard

> **目标**：实现日志解析和指标展示

**状态**: pending
**依赖**: M7

---

## 交付物

### 后端

- [ ] Domain Engines
  - [ ] LogParser（按 DASHBOARD.yaml 提取指标）
- [ ] Config 文件（可选）
  - [ ] config/prompts/dashboard-generator.yaml
- [ ] Dashboard Use Cases
  - [ ] get-dashboard-config.ts
  - [ ] get-dashboard-metrics.ts
- [ ] dashboard.ipc.ts

### 前端

- [ ] DashboardPage 页面
- [ ] StatCard 组件
- [ ] 指标图表（可选，v2 可增强）

---

## 验收标准

- [ ] 能读取项目目录下的 DASHBOARD.yaml 配置
- [ ] 能从 logs/ 目录解析指标值
- [ ] Dashboard 页面正确展示配置的指标
- [ ] 支持 counter 类型指标（累计值）
- [ ] 支持 gauge 类型指标（当前值）
- [ ] 支持 latest 类型指标（最新一条）

---

## IPC 通道

| 通道 | 说明 |
|------|------|
| `dashboard:getConfig` | 获取 DASHBOARD.yaml 配置 |
| `dashboard:getMetrics` | 获取解析后的指标数据 |

---

## DASHBOARD.yaml 格式

```yaml
metrics:
  - name: total_requests
    type: counter
    pattern: 'Processed (\d+) requests'

  - name: error_rate
    type: gauge
    pattern: 'Error rate: ([\d.]+)%'

  - name: last_sync
    type: latest
    pattern: 'Sync completed at (.+)'
```

---

## LogParser 逻辑

```typescript
interface LogParser {
  parse(
    config: DashboardConfig,
    logFiles: string[]
  ): MetricValues
}

// 对每个 metric：
// 1. 遍历日志文件
// 2. 用 pattern 正则匹配
// 3. 根据 type 聚合：
//    - counter: 求和
//    - gauge: 取最后一个值
//    - latest: 取最后匹配的字符串
```

---

## Dashboard UI

```
┌─────────────────────────────────────────────────────┐
│ Dashboard                                            │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ Total Req.  │  │ Error Rate  │  │ Last Sync   │ │
│  │             │  │             │  │             │ │
│  │   12,847    │  │    0.3%     │  │ 2024-01-15  │ │
│  │             │  │             │  │   09:23:45  │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
│                                                     │
│  Run History                                        │
│  ┌─────────────────────────────────────────────┐   │
│  │ #12  2024-01-15 09:00  success  [View Log]  │   │
│  │ #11  2024-01-14 09:00  success  [View Log]  │   │
│  │ #10  2024-01-13 09:00  failed   [View Log]  │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 参考文档

- [DOMAIN.md](../BACKEND/DOMAIN.md) - LogParser
- [IPC.md](../IPC/IPC.md) - 2.7 Dashboard
- [PAGES.md](../FRONTEND/PAGES.md) - DashboardPage
